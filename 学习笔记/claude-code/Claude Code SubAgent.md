# Claude Code SubAgent 学习笔记

## 概述

Claude Code SubAgent（子代理）是Claude Code中的重要功能，它允许用户将复杂的任务分解为多个可独立执行的子任务，从而提高工作效率和代码质量。

## 核心概念

### 什么是SubAgent

- **定义**：SubAgent是Claude Code中的专用代理工具，专门用于处理复杂的多步骤任务
- **作用**：将大型、复杂的任务分解为更小、更易管理的子任务
- **优势**：可以并行处理、独立执行、保持上下文

### 主要特性

1. **任务分解能力**
   - 将复杂任务拆分为多个独立的子任务
   - 每个子任务可以专注于特定功能

2. **并行执行支持**
   - 支持多个SubAgent并行工作
   - 提高整体处理效率

3. **上下文保持**
   - 子代理之间可以共享上下文
   - 保持任务的连贯性

4. **专业化处理**
   - 不同类型的子代理擅长不同领域
   - 提供针对性的专业能力

## 子代理类型

### 1. 通用型子代理 (General-purpose)
- **用途**：处理各种通用任务
- **特点**：灵活性强，适用于多种场景

### 2. Bash子代理 (Bash)
- **用途**：命令执行、脚本运行、文件操作
- **特点**：专门处理终端命令和Shell脚本

### 3. 探索型子代理 (Explore)
- **用途**：代码库探索、文件搜索、模式识别
- **特点**：快速定位和分析代码结构

### 4. 规划型子代理 (Plan)
- **用途**：制定实施计划、架构设计、策略规划
- **特点**：为复杂任务提供系统性解决方案

### 5. 代码简化型子代理 (Code-simplifier)
- **用途**：代码重构、优化、简化
- **特点**：专注于代码质量和可维护性

## 使用方法

### 基本调用语法

```json
{
  "task_type": "subagent_type",
  "description": "任务描述",
  "prompt": "详细指令",
  "run_in_background": true/false
}
```

### 重要参数说明

- **task_type**：指定子代理类型
- **description**：简洁的任务描述（3-5个词）
- **prompt**：详细的任务指令，包含所有必要上下文
- **run_in_background**：是否后台运行

### 运行模式

#### 同步模式 (run_in_background: false)
- **特点**：立即返回结果
- **适用**：快速任务、独立操作
- **优势**：简单直接，不需要额外等待

#### 异步模式 (run_in_background: true)
- **特点**：返回任务ID和输出文件路径
- **适用**：耗时任务、复杂操作
- **优势**：不阻塞主流程，支持后台处理

### 任务获取结果

#### 自动通知方式
- 任务完成时自动发送`<task-notification>`
- 包含完整执行结果

#### 主动查询方式
- 使用`TaskOutput`工具查询任务状态
- 支持阻塞(block=true)和非阻塞(block=false)模式

#### 文件直接读取
- 直接读取输出文件获取结果
- 适用于调试和日志查看

## 最佳实践

### 何时使用SubAgent

1. **并行可处理的工作**
   - 主任务 + 子任务
   - 多个独立的子任务

2. **保持主代理上下文**
   - 避免上下文窗口溢出
   - 专门处理特定领域任务

3. **复杂任务处理**
   - 多步骤实施
   - 需要专业知识的任务

### 何时不使用SubAgent

1. **简单直接的任务**
   - 读取单个文件
   - 执行单个命令
   - 基本的文本替换

2. **高度相关的任务**
   - 紧密耦合的操作
   - 需要实时交互的流程

### 设计原则

1. **明确的任务描述**
   - 提供清晰、具体的任务目标
   - 避免模糊不清的指令

2. **充分的上下文信息**
   - 包含必要的背景信息
   - 提供相关文件和路径

3. **合理的任务粒度**
   - 既不能过大也不能过小
   - 保持任务的独立性和完整性

## 实际应用场景

### 代码分析项目
- 使用Explore子代理分析代码结构
- 并行处理多个分析维度
- 综合分析结果

### 自动化任务
- Bash子代理处理文件操作
- 通用子代理处理业务逻辑
- 实现端到端的自动化流程

### 文档生成
- 探索型子代理收集信息
- 规划型子代理设计文档结构
- 通用子代理执行文档编写

## 注意事项

### 路径规则
- 子代理继承vault作为工作目录
- 引用文件时必须使用相对路径
- 绝对路径会在子代理中失败

### 上下文管理
- 每个子代理有独立的上下文
- 需要明确传递相关信息
- 避免上下文丢失

### 错误处理
- 制定适当的错误处理策略
- 设置合理的超时时间
- 提供备选方案

## 总结

Claude Code SubAgent是一个强大的任务分解和并行处理工具。通过合理使用不同类型的子代理，可以显著提高复杂项目的处理效率和代码质量。关键在于：

1. **选择合适的子代理类型**
2. **设计合理的任务分解策略**
3. **保持清晰的上下文传递**
4. **平衡并行性和依赖关系**

掌握SubAgent的使用方法，能够帮助开发者更好地管理复杂任务，提高开发效率。